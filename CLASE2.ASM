;	Israel Celis Campagnoli
;	twitter @israelcelis1310
;	https://ve.linkedin.com/in/israelceliscampagnoli
;	Practicas en Assembler Digitales III
;	Universidad Nacional Experimental "Antonio Jóse de Sucre"
;	Vicerectorado "Luis Caballero Mejías"
		.MODEL SMALL
		.STACK 100H
		.DATA
CESI		DW 0000H
CEID		DW 0109H
BUFFER		DW 2000H DUP(?)
FILA		DB ?
COL		DB ?
CESI1		DW ?
SW		DB ?
UT1		DW ?  		;ES DW Y NO DB. ERROR DE TRANSCRIPCION.
LIN1		DB "CESI: $"
LIN2		DB "CEID: $"
BUFF		DB 05H
CANT		DB ?
TEXTO		DB 80H DUP(?)
SW2		DB 4 DUP(?)
FILAR		DB ?
CESIA		DW ?
		.CODE
		MOV AX,SEG CESI
		MOV DS,AX
		MOV AX,0B800H
		MOV ES,AX
		CALL CALCULA
		MOV SW,00H
		CALL SALVAR
		MOV AX,CESI1
		MOV UT1,AX
		MOV SI,OFFSET LIN1
		CALL IMPRIME
L1:		MOV DX,0006H
		CALL CURSOR
		MOV DX,OFFSET BUFF
		CALL EDITA
		CMP CANT,04H
		JNE L1
		CALL VERIF;VERIFICAR Q LO Q SE INTRODUJO ES NUMERO ASCII 
		CMP SW,00H;SI ES LETRA ENTRE A Y F SE LE RESTA 37H
		JNE L1
		MOV CESI,DX
;*****TODO ESTO FUE OMITIDO EN CLASE. *************
		ADD UT1,0A0H
		MOV SI,OFFSET LIN2
		CALL IMPRIME
;***************************************************		
L2:		MOV DX,0106H
		CALL CURSOR
		MOV DX,OFFSET BUFF
		CALL EDITA
		CMP CANT,04H
		JNE L2
		CALL VERIF
		CMP SW,00H
		JNE L2
		MOV CEID,DX
;*****TODO ESTO FUE OMITIDO EN CLASE. *************
;LAS 2 PRIMERAS LINES CIERRAN LA PEQUE¥A VENTANA DONDE SE METIERON LAS
;COORDENADAS. EL RESTO ES PARA VERIFICAR QUE LOS NUMEROS INTRODUCIDOS
;NO SE SALGAN DE LA PANTALLA Y QUE CESI SEA MENOR QUE CEID.
		MOV SW,01H
		CALL SALVAR
		MOV AX,CESI
		CMP AH,24
		JA FINMALO
		CMP AL,79
		JA FINMALO
		MOV DX,CEID
		CMP DH,24
		JA FINMALO
		CMP DL,79
		JA FINMALO
		CMP AH,DH
		JAE FINMALO
		CMP AL,DL
		JAE FINMALO
;***************************************************		
		CALL CALCULA
		MOV SW,00H   ;ES 00 Y NO 04 ERROR DE TRANSCRIPCION.
		CALL SALVAR
		CALL ESCRIBE
		MOV SW,01H
		CALL SALVAR
		CALL TECLA   ;ESTO SE COLOCA SOLO PARA EL RESULTADO.


FIN:		MOV AX,4C00H
		INT 21H

FINMALO:	MOV AX,4C01H
		INT 21H



CALCULA:	MOV AX,CESI;SE LE RESTA A CEID CESI
		MOV DX,CEID
		SUB DH,AH
		INC DH
		MOV FILA,DH
		SUB DL,AL
		INC DL
		MOV COL,DL
		MOV CX,CESI
		MOV AX,00H
		MOV AL,CH
		MOV BX,0A0H
		MUL BL;Y GUARDA EN AX
		MOV CH,00H
		ADD CX,CX
		ADD AX,CX
		MOV CESI1,AX
		RETN
				
SALVAR:		MOV SI,OFFSET BUFFER
		MOV DI,CESI1
		MOV UT1,DI
		MOV CH,FILA
S1:		MOV CL,COL
		MOV DI,UT1
S2:		CMP SW,00H
		JNE S3
		MOV AX,ES:[DI]
		MOV DS:[SI],AX
		MOV ES:[DI],3E20H;ESPACIO Y ATRIBUTO COLOR CIAN
		JMP S4
S3:		MOV AX,DS:[SI]
		MOV ES:[DI],AX
S4:		ADD SI,0002H;DE DOS EN DOS POR Q SE TRABAJA CON PALABRA
		ADD DI,0002H
		DEC CL
		JNZ S2 
		ADD UT1,0A0H;SIGUIENTE LINEA
		DEC CH
		JNZ S1
		RETN

IMPRIME:	MOV DI,UT1
		MOV AH,3EH
I0:		MOV AL,DS:[SI]
		CMP AL,"$"
		JE I1
		MOV ES:[DI],AX
		ADD DI,0002H
		INC SI
		JMP I0
I1:		RETN

CURSOR:		MOV AH,02H
		MOV BH,00H
		INT 10H
		RETN

EDITA:		MOV AH,0AH
		INT 21H
		RETN

TECLA:		MOV AH,00H
		INT 16H
		RETN

VERIF:		MOV SW,00H
		MOV DI,OFFSET SW2
		MOV SI,OFFSET TEXTO
		MOV BL,04H
V0:		MOV AL,DS:[SI]
		CMP AL,30H
		JB VSAL
		CMP AL,39H
		JNBE V1
		SUB AL,30H
V4:		MOV DS:[DI],AL
		INC DI
		INC SI
		DEC BL
		JNZ V0
		JMP SALIDA 
V1:		CMP AL,"A"
		JB VSAL
		CMP AL,"F"
		JA VSAL
		SUB AL,37H
		JMP V4
SALIDA:		MOV DI,OFFSET SW2
		MOV BL,02H
SA1:		MOV DH,DL	;S1 ERA UNA ETIQUETA REPETIDA. ERROR EN CLASE.
		MOV AL,DS:[DI]
		ROL AL,04H
		INC DI
		ADD AL,DS:[DI]
		MOV DL,AL          
		INC DI
		DEC BL
		JNZ SA1
		RETN
VSAL:		INC SW
		RETN
ESCRIBE:	MOV AL,FILA
		MOV FILAR,AL
		MOV AL,COL
		MOV BUFF,AL
		INC BUFF
		MOV DX,CESI
		MOV CESIA,DX;CESIA DEFINIRLA COMO PALABRA Y DEFINIR FILAR COMO DB
E1:		MOV DX,CESIA
		CALL CURSOR
		MOV DX,OFFSET BUFF
		CALL EDITA
		ADD CESIA,0100H
		DEC FILAR
		JNZ E1
		RETN

		END



